Laboratoire 1

Optimiser la densité d’implantation d’arbres dans les parcs de Montréal (problématique factice)

  


[**Pré requis**** ****2**](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.hgyuo2ihqxc)

[**Déroulement et explications**** ****2**](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.krc72fxjud2t)

[**Problématique à résoudre**** ****2**](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.dwefjrz9ycku)

[**Outils**** ****2**](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.j4o5xbwnydw)

[**Analyse de la densité arboricole par parc**** ****3**](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.9y5jzn4jbbgt)

[Étape 1 3](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.2h1l4keql873)

[Étape 2 3](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.y70xrg74r05)

[Étape 3 4](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.a0okjhrnmipm)

[Étape 4 5](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.me89d8pa70ld)

[Étape 5 6](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.rh09lfv567oy)

[Étape 6 7](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.2qe3big3iyaf)

[Étape 7 8](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.rdp879ypce4f)

[Étape 8 9](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.qakgwoaln4nu)

[Étape 9 9](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.ekld72m2o1jc)

[Étape 10 10](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.1o6tvjnl458f)

[Étape 11 11](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.5hzoozmhqh8l)

[Étape 12 12](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.20hn7tcfuogi)

[Étape 13 13](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.ui1ppatir77c)

[Étape 14 13](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.qq7mgwvaoaz0)

[**Analyse de la densité arboricole grille H3**** ****14**](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.yziuu8mehgxl)

[Étape 1 14](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.tlx69s3qe7pr)

[Étape 2 15](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.febn6xa5a9bf)

[Étape 3 15](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.5flvbl875s4m)

[Étape 4 16](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.x2nnolvlcr9r)

[Étape 5 16](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.y8vh9yu4tbfx)

[Étape 6 16](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.un94tv301m0q)

[Étape 7 17](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.102x5d82x7kd)

[Étape 8 17](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.614sjo1tqtnq)

[Étape 9 18](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.tdp03zesh1ec)

[Étape 10 19](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.iycmwzqyfimg)


# Pré requis

- [Oracle VM Virtual box](https://www.virtualbox.org/wiki/Downloads)
- [L’image de la machine virtuelle pour installer votre environnement de travail](https://drive.google.com/file/d/1ectuc8jB1ZE8aR7vCVyrGHZ1ElUbOhjC/view?usp=share_link)


# Déroulement et explications

Chaque laboratoire aura un thème, une problématique particulière, il faudra résoudre la problématique avec les logiciels demandé




# Problématique à résoudre

Optimiser la densité d’implantation d’arbres dans les parcs de Montréal


# Outils

FME et QGIS


# Analyse de la densité arboricole par parc


## Étape 1

Lire les données nécessaires depuis le site des données ouvertes:

- Arbres (points) (csv)
- Parcs (polygones) (geojson)

Indice :  Ne trouver que l’URL


## Étape 2

1. Ouvrir FME
2. Créer un WB vide
3. Ajouter un READER CSV
4. Choisissez l’option URL

 

![](https://lh4.googleusercontent.com/RpxyuHdzJ7TcWfnZyCdrX3z0mBzZdRE7uXuBaUwZeCR9B_6nTsaE1D3HgenXR-VHLpXRHStdevkjMMHRbX08DZWs1WnCc25eoZaALvz6atiBel0qhoqESANoT2CtvijmtaHq5SSVlNly1N9ZGQGQboa1t8j5E_CL1Z9KaRrMJ2ch5WVPFl3P8BdS6SEHLg)


## Étape 3

1. Ajouter un READER Geojson
2. Choisissez l’option URL 

Assurez vous que vos données sont chargées correctement avec l’option JUST RUN THIS

![](https://lh6.googleusercontent.com/hnG4HRaSAPoRKw7ffUtdfnklHZsTyFGvwljbDdbTCQuZi4-Mqxw9q834w5Oa9GDZ--hCwzzC2CRBiugShor9If-RwmShh3zV_jNkh3mnNslH2m2aVgNwCR68FvsB1Yh8Dvoh5v0VLowQg2yNXWzN947opG_pHQs8YYswJMi-z2IFOUOEN2bhUFW5LXe2Kw)

Assurez vous que l’option ENABLE FEATURE CACHING soit bien activée

![](https://lh4.googleusercontent.com/S31eWixtZX_Lxf5U57ZPbGRbm1U4yFJQC1w5eV62vrdUXGHUkj7365x-3YLtqgr62U5lg98DRltkSBv2DJsD8OzM5VTBKDBUTd4Vg8f0xwfIsEYw22GZgbmfjOCn9YkBXZPtMjpNtAwCW4MwIKObxQ6drzP0xW4SVl6YYss_0P8A2ed2szvnHwDOvIdCwg)

  


Vous allez ensuite pouvoir inspecter vos données avec l’inspecteur (icone de loupe ou d’oeil)

![](https://lh4.googleusercontent.com/3lkJAff9Js5RlOLG-IsLYHtyWOwjVETvcDn8J91fR5Ns6nV4NQQR9KsnMBKTvBMKgXSu2evi0atUr-6TJgKnmFSw3fBJBMqCyZAi6irvcRHsP1HkjCPlfpgmXiL6ocxuVqdOoMCDJX-mkAvIrKfPozLpaxGPCanQ24yK2pIcbeFCrZfTpnsnbShM_xzKYQ)

![](https://lh6.googleusercontent.com/DOOmCH43pB7k6JPV7_DznzQWAkawrPYk9iJa1jIfNjEt3dy3LPfCi4pgR7LcaR6WwRMDFSfec_fR80rD9EbdK_c7GhfW9GITvgpjknL4zD-HGCvUrc5TAfNMbtFNbuCN8tpcvjAmPObDjW3JRLyW24SEPoHTNRxc75iudIRjdrJtdr0T-RITCmXcDwViwA)


## Étape 4 

Reprojeter les données (parcs et arbres) en 3857 à l’aide du TRANSFORMERS : reprojector

![](https://lh4.googleusercontent.com/LGy8q8nU6VhJ_jfQ-lMuM8JTH-r9ZRUUERoWmxtzq3ytdbZIqwQ9BzzrvKmYAAcI7OgtllP58ARt6Pn_osC-Jck8plsKk86ltDQAMaEjvbY2K8Mh0EUPtjjcpx1vgTrCx-_tQ5p_EbGQ6EM2RZhiufTa0lYUsOyRmQY-hcs0nmYvk_w0bStkfAfUMoGVfg)




## Étape 5

Faire une jointure spatiale pour compter le nombre d’arbres dans chaque parc, avec le TRANSFORMERS : PointOnAreaOverlayer

![](https://lh3.googleusercontent.com/4ce7ZIZngfKJvzz8PrdouqbuCVKx6UWyetvBeCsyuE5a1m_PHTPEm3m8pPlmYa7Rp55ZMMZdhBXFb4hn54Uop2oz82U0zvU1lJSHty3kixhjxL79-TkZCC8cW0kydc6FNn7JjOtsrx_B6FYafS5JGBTFZgCFHjGbhayAYNjKiki80HEiEiQfEVGoJuVz_w)


## 


## Étape 6

On choisit seulement les attributs nécessaires dans la nouvelle couche de données avec le transformer ATTRIBUTEKEEPER

![](https://lh5.googleusercontent.com/ghEglwV0ojCp9R-L6O0_6gPYfMXR--OMxTk1_Tjw1eSCWyKgODNAPuk52yFxHiquCPWKeCqqWMlhK8eUvCjQvzUTm8iIBzKZyptYjwk91RUHKKC66mvs8PzmHseB5CdGHXUcRNIBkNteqPU-AGvJOuO8qLmUeTggzErH71vVi0VErSJAvtHWSoUCME72aQ)

On n’oublie pas d’attacher une boite de LOG aux features qui sont rejetées pour ne pas créer de goulot, car le processus risque de s’arrêter si vous avez des _“erreurs”_

_(cliquez droit sur la petite flèche grise pour faire apparaître l’option de connexion_

_![](https://lh4.googleusercontent.com/pimougrzgjv0acKkMDx3GzQ-IyIAVoToLQBJFvyBgC1VPQiTCUxLiiocHt6UnVpzk3ZdmXh-nnEt8OwEP11A05zuRqrpJkcUGNgS30paz2AXvhGP6Mg8Xz-8GG9Adm9Yxhv3s3cGb4k9zbNLgH_jp9sqfPk_k0wZzo1d4YaV4YXN1dzW4QMJuOxlcQWHVQ)_

_![](https://lh4.googleusercontent.com/Trhi6rH-usHj_lufvSTGdPhuIkGbB5UtXxCZ4DIX_g0CuTpz_k3-tEKFWk3ycOiaQ09WZ41-24oWDKR3tRYVhZLIgBnycg2EXXFhaXBIsTeZor06MV4clSLw1u8zUesHwwtwBa8xi3cav8vajYWCXURnI7JXgKQ8sdzQk7fRN54ARslC7SWODV22yYJhQQ)_





## Étape 7

On calcule la densité d’arbres par m2 par parc

Ajouter un attribut avec le TRANSFORMERS : AttributeCreator

![](https://lh4.googleusercontent.com/zut7Dphuo_570LiOo6CNUwtEsYW1vQDgRiAzP7PTnaOAJxLSWLjWlPkkxA8LMYs0TiBi5M1nnUhdrtlLo77bp9Ql4RLK8R6jqRohChq2u1qePyzSRe0skAVMSeknnWFWFp4GGTgMp3e8NyqN9rNrPfBEsw1muAF89SiVXt_pT2aNY-XvB2eXURXwu035bg)


## 


## Étape 8

Renommer les champs pour une meilleur lisibilité avec le TRANSFORMER : attributeManager

![](https://lh3.googleusercontent.com/z4RxmwY6_T1mFMAG2edtvrVx5izAQ-wWgZB5SkXuY8W0g7QJht3yqxb03S13K4353Eig4vDY1UmnoW_8uwQwg97Swcd9bZLtjS42co8TqiDZMkaZW4rqNhr9mA8SnKoarp1Do3OH3BgBifzSlnLrbT634QKhuYoQiJS_r1j-LS4rd05CKd6zd6dCyb70Rw)




## Étape 9

Calcul de la médiane de densité

Avec le TRANSFORMERS : StatisticsCalculator vous pouvez calculer toutes sortes de statistiques sur un ensemble de données

Calculer la médiane pour les 2 variables suivantes : tree_count, tree_density

![](https://lh6.googleusercontent.com/wkdKSi80nL39Ks-I4p-bsNtqiQNa-AyUkRkdKfX-AQ41tTVzsMBbYW-cdFAhCjkOiodX552uKg4q09Q8V51EfKFw2O1p9I7EMGyYSh-mvuEF724m1JxOSOVpcrcJM8nTmPuK18OkwUA_tTZ2r57YS-D8Lwbu_UmQckk3lndJU1MzbCYUqu1E4_oXkdgUeA)




## 


## Étape 10 

Calcul de l’index par rapport à la moyenne

Transformers : AttributeManager

![](https://lh6.googleusercontent.com/rfKaBzowctsv-0nX4G1somh2-09Vd7PE4vP2YsG__p9akcl-4mENmtaj0tiCuRQKLHOON0fHgfFmaWeQnubgJ7-Vb78gVnWgrSnO0cHiHheyAsw7sFrzNgOZl-HhOrpuC-KMwBvi2qEofIaASFwlmy4ojSGU2-v28r8aPIwY3u-K4ki52iRTCSqGOnHgWg)




## 


## Étape 11

 Nettoyage des données

On ne veut pas de données vides, ou avec des caractères spéciaux, on veut une BD uniformes avec des valeurs de type null si les données sont vides.

Transformers : NullAttributeManager

  


![](https://lh5.googleusercontent.com/vq96m4jPldBhftn0Qshaizq_zCQiroDupw_BGwg6KD_BpxJ5wJhC8rht9wN96vtR38aiuE3SarsjFhEEep7OjEEuhafeMvVVDQbXIOAuUu_-o9M5Eeg4V7HM2ifQ5llJECuCH3NCC8AjVHI0Gl5Sxyuprh_DGGS0Ph7bzxGGkKNa3M3Ege0QZfcPyUfIuQ)


## 


## Étape 12

Écrire la table dans la base de données Postgis

Créer la connexion dans les propriétés de FME (mot de passe _myscecretpassword_)

  
![](https://lh5.googleusercontent.com/0nDt8nd_s0QoOBFGo32MvVMTyVHs4JtneTUuuo2Go54193uwz8fCRL4rG1nAzNXe_kLnBAB1Cp_zVwJjmGyzKt_Kb28NXLq506NI_WWdr5KJWhfyTVTLgE4TNeJDoHlS5oejoDaVgsz_ur9xLZlv4enyFSRZRUiT4RHqunNYb7tCr85n4BrK_zDDgdDoZQ)

![](https://lh6.googleusercontent.com/QrW9vfaUG3s4iVW2SgfsVyKJIzFuxoL0d3DzNMdRDIYpbJCn_VZ9blaKQOhqD8jHUG8EZRNcvUAXfSUFwBHahjGkS1Hco0elu7wYib207O3KJtGayEE9JkkSU5JJ9nyII7VzF_bMORKjKLXQcTbIr8bFEc1hk8lLlVkZbCz_V4IOjnBfv8TNtN5odbZB_Q)

![](https://lh4.googleusercontent.com/vDsTQ8mj0mOMUAw4fCQ-ibAbLm9DxyP_jb9igDMnkD0WzrH8D_7nB1RMn5GYd0KaVih4-AmB02XEXqE65w9vtdpgEMuOusjwRQ7xT2WwXSp635kr2SzT9w4oFLeCa8wWJmPtOF-WjrBenYSHL8fVcXi8nw3phg9AQGNNZdZLi-axem3oACa-sGTH71TuFQ)

Writer : Postgis

![](https://lh6.googleusercontent.com/57VPUiUj28VOBrCMy4qwMhpH_5ITiyLhayap6CBPvpHNmCbfKeS7-9GyRqF-PCUakVRWrMGp3ff9Cuon_GlpH5g_dqSltC7Eu90mV-JMQhjMKXR5xU9qRWv-wD7Hn1BDBx7cs-5vQCvqfrYAvgt9zl93EFUwsdAD3b4SST2lxhl7A4ARJrvy7Os95kw2ZQ)


## Étape 13 

Ouvrir la table dans QGIS

![](https://lh5.googleusercontent.com/19NK5ahi5VLvic0WglnHLs8Vn-qc10--A352q9XlTQFL6RTb9BY2AYMDvWlbwUWkHh_S2daUVRlTVISqtycGssGpk_aOnvDA1Isq54lE32Afd_GqHYtaAdLYJM089VHAP2MPnt_NpwfYUiSMCJslX4uZrMFbhId7zdSyyfkdkY1nteyopHDTbFFr0jya0A) 


## Étape 14

Sauvegarder le style .sld et dans la BD![](https://lh6.googleusercontent.com/uBfZVdrECU1RrgDeeLNVLMso2HMjREJ1AS7X1Z2XUuo8SBGEStX22AD5gQ59YbW9w4UuG-OVmJu4bt0MOfZe-Bxeo_NW4u8R7lfgc8rUDgcN8sP6Ck_42alE8cqLnfDX8ys2TXj8pw1_p9GADdD3mW9Q8OEZ7V1vrkMtMsxARgg6VElWXaAKWZoUgaelNg)


# Analyse de la densité arboricole grille H3


## Étape 1

Création de la grille/index H3 

On connecte directement le READER des parcs (polygones) avec le transfomer 

Transformers : H3HexagonalIndexer

![](https://lh5.googleusercontent.com/VW_z7LQu-ukHWwLdJmWBEGaC9rSqNrLUsePTH4scqSD6xA5A8XZDKSX8stWCvMNEFs5_gpZ39-mA1RNjEvmD5KLuOryuPpPoUXVKrNHz9uJbLWhrZGIe7msJ3rgqu2NMBwrc7YSAg3TT_KmEDGT86WAGy0XDnTChGONgNRNpc31QPmGac0COJj7qM_0sqw)

On oublie pas de mettre un logger sur les rejected au cas ou


## 


## Étape 2 

Dissolution (fusion) des indexes h3 par numéro d’index pour ne conserver qu’un seul hexagones par index

(1 arbre génère 1 hexagone dans la grille avec le H3HexagonalIndexer)

Transformer : Dissolver

![](https://lh5.googleusercontent.com/Dl21AkIQw6Etpg_1oaY75LosdjwskuG-SOzNauxHm_lZcyugN4LMbafgoAGyc9xANMjFinDPQ1aGqdvjwAaAkwglOLDxqgQVINWk6DFoDIlWSDMbmJDTFxaY6fIcU6G7psNy2plxn4ay1EJwvz7A7kOPwKTw_fbu_EPUzq36kCdt9PjhkIR83ZAjAhqSCg)


## Étape 3

Reprojection de 4326 à 3857




## Étape 4

Jointure spatiale pour compter le nombre d’arbres dans chacun des index H3

Transformer : PointOnAreaOverlayer

![](https://lh3.googleusercontent.com/q5lqcbkYpA2ssss6dP9J5nwSmGqeh1-tG8Ytr9ljjGPVbpXndcVLOqHG0lw6WC9ctV95IAXfwKc0-z7XRANJFTQpZNBwP890iSuNlRu8qMTtAKWQ4iKRL-edEHN32yj8V2lKIxDxA-Iw7hl-9oy1l1uvJaNvxlGgAeazKA0kLbealY1c8QiEuWShEAElWQ)






## Étape 5

On garde seulement les attributs désirés : point_count,\_geometry,\_h3index

Transformer : Attribute keeper


## Étape 6

On renomme les champs qu’on veut exporter dans la bd

Transformer : AttributeManager

![](https://lh6.googleusercontent.com/kyg6S5tZ87mRJFUuT20VfIcGur4FVbjD8DlJ0FYamczTLCXuwi6fxPxXWVL-mCYKSXL8_ZISyrKrfRryhmPXwYgfYbKF2ClwZ1DM5JI7YcF9uYhXQsRQHoXytLY3XJwq1JSrTQNEoMVeFWDxtgV4JEiNkgXlM7YyHgtbRWGqLCigk-YbLqvMX5YHmSEzRQ)





## Étape 7

On enregistre la grille H3 dans une table dans la BD locale GEO7630

Writers : Postgis

![](https://lh4.googleusercontent.com/FomyqjRZlRU4-p4IulcT53WvyKr2_YQcFtuDd4zaM9I8WMf-bGFN_9U-94yz3kGX52W_1shRMn4n9kPiiOA5U0lPc-kSDXnnSJ31osonO7NQorxmOcOb2w0NM_KRCCymuBm6xUjvLYaeabSFCtkfIWM0BZ5-k1gP41airbX_39vRDE5eIMQXPuvjNGmQaA)


## Étape 8

Ouvrir et styliser la couche dans QGIS

Enregistrer le .sld et enregistrer le style dans la BD

![](https://lh4.googleusercontent.com/c6nwmyYkwGVF8-Dv_nV9HlkXmCSIrrdG2-1lKLNNp69qgHHZbxUsMFz7_7bWjgotFcPdeW0bfO0CeAdp6AMItExf9ieTJ-i1cbhC-4s-pApKecyxFxoDbKnXFriIW9mEX64nTl_T4bj66LNMrQcS0AN4AuoL0GhKbWFxSu6UwTLLI9eEs65ONTqw5eruQw)
